library(rloadest)
library(dataRetrieval)
library(ggplot2)
library(loadflex)
##############################################################################################
#Importing DATA for Cache Creek at GS
##############################################################################################
# Interpolation data:GS SSC data grab sample observations
SSC_GS <- importRDB("GatedSpillWay_SSC.txt")
SSC_GS
### Reading in Flow Data
GSQ <- importRDB("GatedSpillWay_DQ.txt")
GSQ$Dates <- with(GSQ, as.POSIXct(paste(Dates), format= "%Y-%m-%d"))
GSQ
app1.lr <- selBestModel("SSC", data = SSC_GS,
flow = "Flow", dates = "Dates", conc.units="mg/L",
station="Cache Creek at GS")
SSC_GS <- importRDB("GatedSpillWay_SSC.txt")
SSC_GS <- importRDB("GatedSpillWay_SSC.txt")
SSC_GS
SSC_GS <- importRDB("GatedSpillWay_SSC.txt")
SSC_GS
### Reading in Flow Data
GSQ <- importRDB("GatedSpillWay_DQ.txt")
GSQ$Dates <- with(GSQ, as.POSIXct(paste(Dates), format= "%Y-%m-%d"))
GSQ
app1.lr <- selBestModel("SSC", data = SSC_GS,
flow = "Flow", dates = "Dates", conc.units="mg/L",
station="Cache Creek at GS")
print(app1.lr)
SSC_GS_lr1 <- loadReg(SSC ~ model(1), data=SSC_GS,
flow="Flow", date="Dates", time.step="day",
flow.units="cfs", conc.units="mg/L",load.units="kg",
station="Cache Creek at GS")
SSC_GS_lr1
SSC_GS_lr2 <- loadReg(SSC ~ model(2), data=SSC_GS,
flow="Flow", date="Dates", time.step="day",
flow.units="cfs", conc.units="mg/L",load.units="kg",
station="Cache Creek at GS")
SSC_GS_lr2
SSC_GS_lr3 <- loadReg(SSC ~ model(3), data=SSC_GS,
flow="Flow", date="Dates", time.step="day",
flow.units="cfs", conc.units="mg/L",load.units="kg",
station="Cache Creek at GS")
SSC_GS_lr3
SSC_GS_lr4 <- loadReg(SSC ~ model(4), data=SSC_GS,
flow="Flow", date="Dates", time.step="day",
flow.units="cfs", conc.units="mg/L",load.units="kg",
station="Cache Creek at GS")
SSC_GS_lr4
SSC_GS_lr5 <- loadReg(SSC ~ model(5), data=SSC_GS,
flow="Flow", date="Dates", time.step="day",
flow.units="cfs", conc.units="mg/L",load.units="kg",
station="Cache Creek at GS")
SSC_GS_lr5
SSC_GS_lr6 <- loadReg(SSC ~ model(6), data=SSC_GS,
flow="Flow", date="Dates", time.step="day",
flow.units="cfs", conc.units="mg/L",load.units="kg",
station="Cache Creek at GS")
SSC_GS_lr6
SSC_GS_lr7 <- loadReg(SSC ~ model(7), data=SSC_GS,
flow="Flow", date="Dates", time.step="day",
flow.units="cfs", conc.units="mg/L",load.units="kg",
station="Cache Creek at GS")
SSC_GS_lr7
SSC_GS_lr8 <- loadReg(SSC ~ model(8), data=SSC_GS,
flow="Flow", date="Dates", time.step="day",
flow.units="cfs", conc.units="mg/L",load.units="kg",
station="Cache Creek at GS")
SSC_GS_lr8
SSC_GS_lr9 <- loadReg(SSC ~ model(9), data=SSC_GS,
flow="Flow", date="Dates", time.step="day",
flow.units="cfs", conc.units="mg/L",load.units="kg",
station="Cache Creek at GS")
SSC_GS_lr9
SSC_GS_lr1
SSC_GS_lr2
SSC_GS_lr3
SSC_GS_lr4
SSC_GS_lr5
SSC_GS_lr4
SSC_GS_lr5
SSC_GS_lr7
SSC_GS_lr8
SSC_GS_lr9
SSC_GS_lr1 <- loadReg(SSC ~ model(1), data=SSC_GS,
flow="Flow", date="Dates", time.step="day",
flow.units="cfs", conc.units="mg/L", load.units="kg",
station="Cache Creek at GS")
setSweave("SSC_GS_lr1_plot2",5,5)
plot(SSC_GS_lr1,which=1,set.up=FALSE) #plot 1: Calibrated regression model
graphics.off()
setSweave("SSC_GS_lr1_plot1",5,5)
plot(SSC_GS_lr1,which=2,set.up=FALSE) #plot 2:Estimates of log load versus model residuals from AMLE regression
graphics.off()
setSweave("SSC_GS_lr1_plot3",5,5)
plot(SSC_GS_lr1,which=3,set.up=FALSE)# plot 3: Estimates of log load versus squared model residuals
graphics.off()
setSweave("SSC_GS_lr1_plot4",5,5)
plot(SSC_GS_lr1,which=4,set.up=FALSE) # plot 4: Standardized Serial Correlation
graphics.off()
setSweave("SSC_GS_lr1_plot5",5,5)
plot(SSC_GS_lr1,which=5,set.up=FALSE) # plot 5: Normal probability plot for the model residuals (Quantile plot)
graphics.off()
#############################################################################################
#predict concntrations
###############################################################################################
preds_conc_lr1 <- predConc(SSC_GS_lr1, GSQ, by= "day", allow.incomplete= TRUE )
preds_conc_lr1
exportCSV(preds_conc_lr1, file.name = "GS_SSC_conc_lr1_2010-2019.cvs")
###############################################################################################
##We plot the estimated unite conc Vs the obsereved unite conc in xls
###############################################################################################
###############################################################################################
#load calculations will be done outside Loadest
#But this load calculated will be used to estimate SE for the xlxs calculation
###############################################################################################
preds_Flux_lr1day<-predLoad(SSC_GS_lr1,GSQ,load.units="kg",by="day",allow.incomplete = TRUE,conf.int = 0.95,print = TRUE)
preds_Flux_lr1day
exportCSV(preds_Flux_lr1day, file.name = "GS_SSCFlux_lr1_Day2010-2019.cvs")
preds_Flux_lr1WY<-predLoad(SSC_GS_lr1,GSQ,load.units="kg",by="water year",allow.incomplete = TRUE,conf.int = 0.95,print = TRUE)
preds_Flux_lr1WY
exportCSV(preds_Flux_lr1WY, file.name = "GS_SSCFlux_lr1_WY2010-2019.cvs")
library(rloadest)
library(dataRetrieval)
library(ggplot2)
library(loadflex)
##############################################################################################
#Importing DATA for Cache Creek at GS
##############################################################################################
# Interpolation data:GS SSC data grab sample observations
SSC_GS <- importRDB("GatedSpillWay_SSC.txt")
SSC_GS
### Reading in Flow Data
GSQ <- importRDB("GatedSpillWay_DQ.txt")
GSQ$Dates <- with(GSQ, as.POSIXct(paste(Dates), format= "%Y-%m-%d"))
GSQ
View(SSC_GS)
SSC_GS <- importRDB("GatedSpillWay_SSC.txt")
View(SSC_GS)
app1.lr <- selBestModel("SSC", data = SSC_GS,
flow = "Flow", dates = "Dates", conc.units="mg/L",
station="Cache Creek at GS")
print(app1.lr)
###############################################################################################
SSC_GS_lr1 <- loadReg(SSC ~ model(1), data=SSC_GS,
flow="Flow", date="Dates", time.step="day",
flow.units="cfs", conc.units="mg/L",load.units="kg",
station="Cache Creek at GS")
SSC_GS_lr1
SSC_GS_lr2 <- loadReg(SSC ~ model(2), data=SSC_GS,
flow="Flow", date="Dates", time.step="day",
flow.units="cfs", conc.units="mg/L",load.units="kg",
station="Cache Creek at GS")
SSC_GS_lr2
SSC_GS_lr3 <- loadReg(SSC ~ model(3), data=SSC_GS,
flow="Flow", date="Dates", time.step="day",
flow.units="cfs", conc.units="mg/L",load.units="kg",
station="Cache Creek at GS")
SSC_GS_lr3
SSC_GS_lr4 <- loadReg(SSC ~ model(4), data=SSC_GS,
flow="Flow", date="Dates", time.step="day",
flow.units="cfs", conc.units="mg/L",load.units="kg",
station="Cache Creek at GS")
SSC_GS_lr4
SSC_GS_lr5 <- loadReg(SSC ~ model(5), data=SSC_GS,
flow="Flow", date="Dates", time.step="day",
flow.units="cfs", conc.units="mg/L",load.units="kg",
station="Cache Creek at GS")
SSC_GS_lr5
SSC_GS_lr6 <- loadReg(SSC ~ model(6), data=SSC_GS,
flow="Flow", date="Dates", time.step="day",
flow.units="cfs", conc.units="mg/L",load.units="kg",
station="Cache Creek at GS")
SSC_GS_lr6
SSC_GS_lr7 <- loadReg(SSC ~ model(7), data=SSC_GS,
flow="Flow", date="Dates", time.step="day",
flow.units="cfs", conc.units="mg/L",load.units="kg",
station="Cache Creek at GS")
SSC_GS_lr7
SSC_GS_lr8 <- loadReg(SSC ~ model(8), data=SSC_GS,
flow="Flow", date="Dates", time.step="day",
flow.units="cfs", conc.units="mg/L",load.units="kg",
station="Cache Creek at GS")
SSC_GS_lr8
SSC_GS_lr9 <- loadReg(SSC ~ model(9), data=SSC_GS,
flow="Flow", date="Dates", time.step="day",
flow.units="cfs", conc.units="mg/L",load.units="kg",
station="Cache Creek at GS")
SSC_GS_lr9
#####################################################################################################
# Extract the fitted values look at the output and evaluate the AIC and SPPC stats, the SelBestModel will
#always pick the model with the lowest AIC, but we need to look at the SPPC also if there is a modle with
#a lower SPPC then we need to evaluate that model also and decide which model we will used based on the
#p-values of the perameters and the Bias (BP, needs to be as lower that 25%, and the E value needs to be high)
###############################################################################################
#Run the recomended model, and any other model we might think is good based on the Bp and E values
###############################################################################################
SSC_GS_lr1 <- loadReg(SSC ~ model(1), data=SSC_GS,
flow="Flow", date="Dates", time.step="day",
flow.units="cfs", conc.units="mg/L",load.units="kg",
station="Cache Creek at GS")
SSC_GS_lr1
SSC_GS_lr2
SSC_GS_lr3
SSC_GS_lr4
SSC_GS_lr5
SSC_GS_lr7
SSC_GS_lr8
SSC_GS_lr9
###############################################################################################
SSC_GS_lr3 <- loadReg(SSC ~ model(3), data=SSC_GS,
flow="Flow", date="Dates", time.step="day",
flow.units="cfs", conc.units="mg/L", load.units="kg",
station="Cache Creek at GS")
setSweave("SSC_GS_lr3_plot2",5,5)
plot(SSC_GS_lr3,which=1,set.up=FALSE) #plot 1: Calibrated regression model
graphics.off()
setSweave("SSC_GS_lr3_plot1",5,5)
plot(SSC_GS_lr3,which=2,set.up=FALSE) #plot 2:Estimates of log load versus model residuals from AMLE regression
graphics.off()
setSweave("SSC_GS_lr3_plot3",5,5)
plot(SSC_GS_lr3,which=3,set.up=FALSE)# plot 3: Estimates of log load versus squared model residuals
graphics.off()
setSweave("SSC_GS_lr3_plot4",5,5)
plot(SSC_GS_lr3,which=4,set.up=FALSE) # plot 4: Standardized Serial Correlation
graphics.off()
setSweave("SSC_GS_lr3_plot5",5,5)
plot(SSC_GS_lr3,which=5,set.up=FALSE) # plot 5: Normal probability plot for the model residuals (Quantile plot)
graphics.off()
#############################################################################################
#predict concntrations
###############################################################################################
preds_conc_lr3 <- predConc(SSC_GS_lr3, GSQ, by= "day", allow.incomplete= TRUE )
preds_conc_lr3
exportCSV(preds_conc_lr3, file.name = "GS_SSC_conc_lr3_2010-2019.cvs")
###############################################################################################
##We plot the estimated unite conc Vs the obsereved unite conc in xls
###############################################################################################
###############################################################################################
#load calculations will be done outside Loadest
#But this load calculated will be used to estimate SE for the xlxs calculation
###############################################################################################
preds_Flux_lr3day<-predLoad(SSC_GS_lr3,GSQ,load.units="kg",by="day",allow.incomplete = TRUE,conf.int = 0.95,print = TRUE)
preds_Flux_lr3day
exportCSV(preds_Flux_lr3day, file.name = "GS_SSCFlux_lr3_Day2010-2019.cvs")
preds_Flux_lr3WY<-predLoad(SSC_GS_lr3,GSQ,load.units="kg",by="water year",allow.incomplete = TRUE,conf.int = 0.95,print = TRUE)
preds_Flux_lr3WY
exportCSV(preds_Flux_lr3WY, file.name = "GS_SSCFlux_lr3_WY2010-2019.cvs")
library(rloadest)
library(dataRetrieval)
library(ggplot2)
library(loadflex)
####################
##############################################################################################
SSC_GS_lr1 <- loadReg(SSC ~ model(1), data=SSC_GS,
flow="Flow", date="Dates", time.step="day",
flow.units="cfs", conc.units="mg/L", load.units="kg",
station="Cache Creek at GS")
setSweave("SSC_GS_lr1_plot2",5,5)
plot(SSC_GS_lr1,which=1,set.up=FALSE) #plot 1: Calibrated regression model
graphics.off()
setSweave("SSC_GS_lr1_plot1",5,5)
plot(SSC_GS_lr1,which=2,set.up=FALSE) #plot 2:Estimates of log load versus model residuals from AMLE regression
graphics.off()
setSweave("SSC_GS_lr1_plot3",5,5)
plot(SSC_GS_lr1,which=3,set.up=FALSE)# plot 3: Estimates of log load versus squared model residuals
graphics.off()
setSweave("SSC_GS_lr1_plot4",5,5)
plot(SSC_GS_lr1,which=4,set.up=FALSE) # plot 4: Standardized Serial Correlation
graphics.off()
setSweave("SSC_GS_lr1_plot5",5,5)
plot(SSC_GS_lr1,which=5,set.up=FALSE) # plot 5: Normal probability plot for the model residuals (Quantile plot)
graphics.off()
#############################################################################################
#predict concntrations
###############################################################################################
preds_conc_lr1 <- predConc(SSC_GS_lr1, GSQ, by= "day", allow.incomplete= TRUE )
preds_conc_lr1
exportCSV(preds_conc_lr1, file.name = "GS_SSC_conc_lr1_2010-2019.cvs")
###############################################################################################
##We plot the estimated unite conc Vs the obsereved unite conc in xls
###############################################################################################
###############################################################################################
#load calculations will be done outside Loadest
#But this load calculated will be used to estimate SE for the xlxs calculation
###############################################################################################
preds_Flux_lr1day<-predLoad(SSC_GS_lr1,GSQ,load.units="kg",by="day",allow.incomplete = TRUE,conf.int = 0.95,print = TRUE)
preds_Flux_lr1day
exportCSV(preds_Flux_lr1day, file.name = "GS_SSCFlux_lr1_Day2010-2019.cvs")
preds_Flux_lr1WY<-predLoad(SSC_GS_lr1,GSQ,load.units="kg",by="water year",allow.incomplete = TRUE,conf.int = 0.95,print = TRUE)
preds_Flux_lr1WY
exportCSV(preds_Flux_lr1WY, file.name = "GS_SSCFlux_lr1_WY2010-2019.cvs")
